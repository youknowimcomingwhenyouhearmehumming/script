clear all;
close all;

original = imread('b1.jpg');
figure(2)
imshow(original);
red = original(:,:,1);
green=original(:,:,2);
blue=original(:,:,3);

figure(1)
imshow(red);

hsv = rgb2hsv(original);
figure(3)
imshow(hsv);

hsv_hue=hsv(:,:,1);


mask=[(hsv(:,:,1)>=0.88)& (hsv(:,:,1)<=0.94) & (hsv(:,:,3)>=0.9)] ;

[location_of_dot_x,location_of_dot_y] = find(mask == 1,1,'first') %finding the first element that is equal to 
% "1" in the first 

%These lines is the manual version of "[location_of_dot_x,location_of_dot_y] = find(mask == 1,1,'first')"
% i=1;
% while(true);
%     if mask(i)==1;
%         location_of_dot=i;
%         break
%     end
% i=i+1;
% end 
% location_of_dot_x=mod(location_of_dot,1080) %taking the modolus
% location_of_dot_y=ceil(location_of_dot/1080) %rounding up to next integer

dot=mask.*hsv;

figure(4)
imshow(dot);



Wsub = 30;
Hsub = 20;

[submatrix_red,offsetH,offsetW] = subMatrix(red,location_of_dot_y,location_of_dot_x,Wsub,Hsub)
[submatrix_green,offsetH,offsetW] = subMatrix(green,location_of_dot_y,location_of_dot_x,Wsub,Hsub)
[submatrix_blue,offsetH,offsetW] = subMatrix(blue,location_of_dot_y,location_of_dot_x,Wsub,Hsub)


figure(5)
imshow(submatrix_red);

submatrixRGB = cat(3, submatrix_red, submatrix_green, submatrix_blue);
figure()
imshow(submatrixRGB);

xsums = sum(submatrix_red,2);
ysums = sum(submatrix_red,1);

figure()
subplot(2,1,1)
bar(1:Wsub+1,ysums)
subplot(2,1,2)
bar(1:Hsub+1,xsums)

SUM = sum(xsums);
masssMid_H = (sum(([1:Hsub+1]'.*xsums)')/SUM) + offsetH
masssMid_W = (sum(([1:Wsub+1].*ysums))/SUM) + offsetW











